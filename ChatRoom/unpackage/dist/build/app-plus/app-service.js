if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((s=>t.resolve(e()).then((()=>s))),(s=>t.resolve(e()).then((()=>{throw s}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e){return weex.requireModule(e)}function s(e,t,...s){uni.__log__?uni.__log__(e,t,...s):console[e].apply(console,[...s,t])}const n=[];for(let y=0;y<256;++y)n.push((y+256).toString(16).slice(1));var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,62,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,63,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];const a={getRandomValues(e){if(!(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray))throw new Error("Expected an integer array");if(e.byteLength>65536)throw new Error("Can only request a maximum of 65536 bytes");return function(e,t){for(var s,n=e.length,a="="===e[n-2]?2:"="===e[n-1]?1:0,i=0,o=n-a&4294967292,c=0;c<o;c+=4)s=r[e.charCodeAt(c)]<<18|r[e.charCodeAt(c+1)]<<12|r[e.charCodeAt(c+2)]<<6|r[e.charCodeAt(c+3)],t[i++]=s>>16&255,t[i++]=s>>8&255,t[i++]=255&s;1===a&&(s=r[e.charCodeAt(c)]<<10|r[e.charCodeAt(c+1)]<<4|r[e.charCodeAt(c+2)]>>2,t[i++]=s>>8&255,t[i++]=255&s),2===a&&(s=r[e.charCodeAt(c)]<<2|r[e.charCodeAt(c+1)]>>4,t[i++]=255&s)}(t("DCloud-Crypto").getRandomValues(e.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e}};let i;const o=new Uint8Array(16);const c={randomUUID:void 0!==a&&a.randomUUID&&a.randomUUID.bind(a)};function l(e,t,s){var r;if(c.randomUUID&&!t&&!e)return c.randomUUID();const l=(e=e||{}).random??(null==(r=e.rng)?void 0:r.call(e))??function(){if(!i){if(void 0===a||!a.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");i=a.getRandomValues.bind(a)}return i(o)}();if(l.length<16)throw new Error("Random bytes length must be >= 16");if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,t){if((s=s||0)<0||s+16>t.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[s+e]=l[e];return t}return function(e,t=0){return(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase()}(l)}const u=new class{constructor(){this.subscriptions=new Map}subscribe(e,t,s,n){this.subscriptions.has(e)||this.subscriptions.set(e,new Set),this.subscriptions.get(e).add({page:n,callback:s})}unsubscribe(e,t,s){if(this.subscriptions.has(e)){const n=this.subscriptions.get(e);n.delete({page:s,callback:t}),0===n.size&&this.subscriptions.delete(e)}}dispatch(e,t){if(this.subscriptions.has(e)){this.subscriptions.get(e).forEach((e=>{e.callback(t)}))}}},d=t("mqttPlugin");const m={config:{serverURI:"tcp://120.46.54.180:1883",clientId:(uni.getStorageSync("mqtt-clientId")?g=uni.getStorageSync("mqtt-clientId"):(g="app-"+l(),uni.setStorageSync("mqtt-clientId",g)),g),username:"zechuan",password:"pu200207"},connect(e,t){const{serverURI:s,clientId:n,username:r,password:a}=e;d.connect(s||this.config.serverURI,n||this.config.clientId,r||this.config.username,a||this.config.password,(e=>{e.success?t(!0,e.message):t(!1,e.message||"Connection failed")}))},subscribe(e,t,s){d.subscribe(e,t,(e=>{e.success?s(!0,e.message):s(!1,e.message||"Subscribe failed")}))},subscribeMultiTopics(e,t,s){d.subscribeMultiTopics(e,t,(e=>{e.success?s(!0,e.message):s(!1,e.message||"Subscribe failed")}))},publish(e,t,s,n,r){d.publish(e,t,s,n,(e=>{e.success?r(!0,e.message):r(!1,e.message||"Publish failed")}))},disconnect(e){d.disconnect((t=>{t.success?e(!0,t.message):e(!1,t.message||"Disconnect failed")}))},unsubscribe(e,t){d.unsubscribe(e,(e=>{e.success?t(!0,e.message):t(!1,e.message||"unsubscribe failed")}))},setMessageCallback(){d.setMessageCallback((e=>{if("message"===e.type){const t=JSON.parse(e.message);t.success=!0,u.dispatch(e.topic,t)}}))},setEventCallback(e,t){d.setEventCallback(e,(e=>{t({isConnected:e.isConnected,event:e.event,reason:e.reason,message:e.message})}))}};var g;__definePage("pages/index/index",((e,t)=>{const s=e.__vccOpts||e;for(const[n,r]of t)s[n]=r;return s})({data:()=>({messages:[{id:1,sender:"other",content:"你好呀！",time:new Date(Date.now()-6e4)},{id:2,sender:"me",content:"嗨！最近怎么样？",time:new Date(Date.now()-3e4)},{id:3,sender:"other",content:"还不错，有个新项目想和你聊聊",time:new Date}],inputMessage:"",messageId:4,mqttclient:null}),computed:{lastMessageId(){return 0===this.messages.length?"":"msg"+this.messages[this.messages.length-1].id}},methods:{formatTime:e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,sendMessage(){const e=this.inputMessage.trim();if(!e)return;const t={id:this.messageId++,sender:"me",content:e,time:new Date};this.messages.push(t),this.inputMessage="",setTimeout((()=>{const t={id:this.messageId++,sender:"other",content:"收到你的消息了: "+e,time:new Date};this.messages.push(t)}),1e3)},async connectMqtt(){this.mqttclient=m,this.mqttclient.connect()}},mounted(){this.connectMqtt()}},[["render",function(t,s,n,r,a,i){return e.openBlock(),e.createElementBlock("view",{class:"chat-container"},[e.createElementVNode("scroll-view",{class:"message-list","scroll-y":"true","scroll-into-view":i.lastMessageId,"scroll-with-animation":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.messages,((t,s)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,id:"msg"+t.id,class:e.normalizeClass(["message-item",{"message-right":"me"===t.sender,"message-left":"other"===t.sender}])},[e.createElementVNode("view",{class:"message-bubble"},["other"===t.sender?(e.openBlock(),e.createElementBlock("text",{key:0,class:"sender-name"},"对方昵称")):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"message-content"},e.toDisplayString(t.content),1),e.createElementVNode("text",{class:"message-time"},e.toDisplayString(i.formatTime(t.time)),1)])],10,["id"])))),128))],8,["scroll-into-view"]),e.createElementVNode("view",{class:"input-area"},[e.withDirectives(e.createElementVNode("input",{class:"input-box","onUpdate:modelValue":s[0]||(s[0]=e=>a.inputMessage=e),placeholder:"输入消息...","confirm-type":"send",onConfirm:s[1]||(s[1]=(...e)=>i.sendMessage&&i.sendMessage(...e))},null,544),[[e.vModelText,a.inputMessage]]),e.createElementVNode("button",{class:"send-button",disabled:!a.inputMessage.trim(),onClick:s[2]||(s[2]=(...e)=>i.sendMessage&&i.sendMessage(...e))},"发送",8,["disabled"])])])}],["__scopeId","data-v-caf40c92"]]));const p={onLaunch:function(){s("log","at App.vue:4","App Launch")},onShow:function(){s("log","at App.vue:7","App Show")},onHide:function(){s("log","at App.vue:10","App Hide")}};const{app:h,Vuex:f,Pinia:b}={app:e.createVueApp(p)};uni.Vuex=f,uni.Pinia=b,h.provide("__globalStyles",__uniConfig.styles),h._component.mpType="app",h._component.render=()=>{},h.mount("#app")}(Vue);
